<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Android Club - 10 Years Celebration Expo</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-green: #189807;
            --dark-green: #0F6A05;
            --light-grey: #E7E7E7;
            --dark-background: #000000;
            --subtle-tint: rgba(231, 231, 231, 0.05);
            --border-color: rgba(24, 152, 7, 0.2);
            --shadow-color: rgba(24, 152, 7, 0.3);
            --text-color-faded: rgba(231, 231, 231, 0.8);
        }

        body {
            margin: 0;
            padding: 20px;
            background: var(--dark-background); /* Black background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Roboto', sans-serif;
            overflow-y: auto;
            box-sizing: border-box;
            background-image: radial-gradient(circle at center, rgba(24, 152, 7, 0.08) 1px, transparent 1px);
            background-size: 30px 30px;
        }

        .main-container {
            background: var(--subtle-tint); /* Very subtle white tint for container */
            border-radius: 25px; /* Slightly more rounded */
            padding: 40px; /* Increased padding */
            backdrop-filter: blur(8px); /* Slightly more blur for a premium look */
            box-shadow: 0 10px 40px var(--shadow-color); /* Stronger green shadow */
            border: 2px solid var(--border-color); /* Thicker green border */
            display: flex;
            flex-direction: column;
            gap: 30px; /* Increased gap between sections */
            max-width: 1100px; /* Slightly wider */
            width: 100%;
            margin: auto;
            align-items: center;
            position: relative;
            overflow: hidden; /* For pseudo-element border */
        }

        /* Decorative border effect */
        .main-container::before {
            content: '';
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            bottom: 10px;
            border: 1px dashed rgba(24, 152, 7, 0.3);
            border-radius: 20px;
            pointer-events: none;
        }

        .club-header {
            text-align: center;
            margin-bottom: 30px; /* Space before game */
            color: var(--primary-green);
            position: relative;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--border-color); /* Proper ending border */
            width: 100%;
        }

        .club-logo-large {
            margin-bottom: 20px;
        }

        .club-logo-large img {
            max-width: 220px; /* Slightly larger logo */
            height: auto;
            filter: drop-shadow(0 0 20px rgba(24, 152, 7, 0.9)); /* Stronger green glow */
        }

        .club-main-title {
            font-family: 'Orbitron', sans-serif; /* Techy font */
            font-size: 3em; /* Slightly decreased */
            font-weight: bold;
            margin: 0;
            text-shadow: 3px 3px 8px rgba(0, 0, 0, 0.8);
            color: var(--primary-green);
            letter-spacing: 2px;
        }

        .club-celebration-tag {
            font-family: 'Orbitron', sans-serif; /* Techy font */
            font-size: 2em; /* Slightly decreased but still prominent */
            color: var(--light-grey);
            margin-top: 15px; /* Increased margin */
            font-weight: bold;
            letter-spacing: 1.5px;
            animation: fadeInOut 2.5s infinite alternate; /* Slower, more subtle animation */
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
        }

        .club-expo-text {
            font-family: 'Roboto', sans-serif;
            font-size: 1.2em;
            color: var(--text-color-faded);
            margin-top: 10px;
            font-style: italic;
        }

        @keyframes fadeInOut {
            0% { opacity: 0.7; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.02); }
        }

        .game-section {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 25px;
            align-items: center;
            padding-top: 20px;
        }

        .game-header {
            text-align: center;
            color: var(--primary-green);
            margin-bottom: 10px; /* Adjusted spacing */
        }

        .game-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5em; /* Slightly decreased */
            margin: 0;
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.6);
            letter-spacing: 1px;
        }

        .score-board {
            display: flex;
            justify-content: space-around;
            align-items: center;
            color: var(--light-grey);
            font-size: 1.6em; /* Slightly larger */
            padding: 15px 0; /* Increased padding */
            border-bottom: 2px solid var(--border-color); /* Thicker border */
            width: 100%;
            margin-bottom: 20px; /* Space after scoreboard */
        }

        .player-info {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0 25px; /* Increased padding */
        }

        .player-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.4em; /* Slightly larger */
            margin-bottom: 8px;
            color: var(--primary-green);
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.4);
        }

        .player-score {
            font-size: 2.5em; /* Larger score */
            font-weight: bold;
            color: var(--light-grey);
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
        }

        .controls {
            font-size: 1.1em; /* Slightly larger */
            opacity: 0.9;
            margin-top: 10px;
            color: var(--text-color-faded);
            font-weight: bold;
        }

        canvas {
            border: 4px solid rgba(24, 152, 7, 0.6); /* Thicker, more prominent green border */
            border-radius: 12px; /* Slightly more rounded */
            background: rgba(0, 0, 0, 0.6); /* Darker canvas background */
            display: block;
            margin: 0 auto;
            box-shadow: 0 0 25px rgba(24, 152, 7, 0.4); /* Green glow around canvas */
        }

        .game-status {
            text-align: center;
            color: var(--light-grey);
            font-size: 1.4em; /* Slightly larger */
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding-top: 15px;
            font-weight: bold;
        }

        .restart-btn {
            background: linear-gradient(45deg, var(--primary-green), var(--dark-green));
            color: white;
            border: none;
            padding: 14px 30px; /* Larger button */
            border-radius: 30px; /* More rounded */
            font-size: 1.2em; /* Larger font */
            cursor: pointer;
            margin-top: 20px; /* Increased margin */
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px var(--shadow-color);
            width: fit-content;
            display: block;
            margin-left: auto;
            margin-right: auto;
            font-weight: bold;
            letter-spacing: 0.5px;
        }

        .restart-btn:hover {
            transform: translateY(-4px); /* More pronounced lift */
            box-shadow: 0 8px 25px rgba(24, 152, 7, 0.6); /* Stronger shadow on hover */
        }

        .winner-message {
            color: var(--light-grey);
            font-size: 2em; /* Larger winner message */
            font-weight: bold;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
            animation: pulse 1.2s infinite; /* Slower pulse */
        }

        @keyframes pulse {
            0% { transform: scale(1); color: var(--light-grey); }
            50% { transform: scale(1.08); color: var(--primary-green); } /* More pronounced pulse with green */
            100% { transform: scale(1); color: var(--light-grey); }
        }

        .game-instructions {
            text-align: center;
            color: var(--text-color-faded);
            font-size: 1.1em; /* Slightly larger */
            margin-top: 30px; /* Increased margin */
            opacity: 0.85;
            padding-top: 20px; /* Increased padding */
            border-top: 2px solid var(--border-color); /* Thicker border */
            width: 100%;
        }

        .difficulty-controls, .sensitivity-controls {
            display: flex;
            justify-content: center;
            gap: 50px; /* Increased gap */
            margin-top: 30px; /* Increased margin */
            color: var(--light-grey);
            padding: 20px 0; /* Increased padding */
            border-top: 2px solid var(--border-color);
            border-bottom: 2px solid var(--border-color); /* Add bottom border for full section */
            width: 100%;
            position: relative;
        }

        .sensitivity-controls {
            border-bottom: none; /* Only top border for sensitivity controls */
        }

        .difficulty-section, .sensitivity-section {
            text-align: center;
            flex: 1; /* Make sections take equal width */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .difficulty-section div:first-child { /* Target the difficulty label */
            font-size: 1.3em; /* Slightly larger */
            margin-bottom: 15px;
            font-weight: bold;
            color: var(--primary-green);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .difficulty-buttons {
            display: flex;
            gap: 20px; /* Increased gap between buttons */
            margin-top: 12px;
        }

        .difficulty-btn {
            padding: 12px 25px; /* Larger buttons */
            border: none;
            border-radius: 30px;
            font-size: 1.1em; /* Larger font */
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--light-grey);
            background: rgba(24, 152, 7, 0.25); /* Slightly darker green tint for inactive buttons */
            border: 2px solid transparent;
            font-weight: bold;
        }

        .difficulty-btn.active {
            background: linear-gradient(45deg, var(--primary-green), var(--dark-green));
            border-color: var(--primary-green);
            box-shadow: 0 4px 18px var(--shadow-color);
            transform: translateY(-3px); /* More pronounced lift */
        }

        .difficulty-btn:hover {
            transform: translateY(-3px);
            background: rgba(24, 152, 7, 0.45); /* More distinct green tint on hover */
        }

        .difficulty-btn.active:hover {
            background: linear-gradient(45deg, var(--dark-green), var(--primary-green));
            transform: translateY(-4px);
        }

        .sensitivity-label {
            font-size: 1.2em; /* Slightly larger */
            margin-bottom: 20px; /* Increased margin */
            display: block;
            font-weight: bold;
            color: var(--primary-green);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .sensitivity-slider {
            -webkit-appearance: none;
            width: 180px; /* Wider slider */
            height: 10px; /* Thicker slider */
            border-radius: 5px;
            background: rgba(24, 152, 7, 0.5); /* Stronger green tint for slider track */
            outline: none;
            display: block;
        }

        .sensitivity-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px; /* Larger thumb */
            height: 28px; /* Larger thumb */
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary-green), var(--dark-green));
            cursor: grab; /* Cursor indicates drag */
            box-shadow: 0 4px 15px var(--shadow-color);
            transition: background 0.3s ease, transform 0.3s ease;
            border: 2px solid var(--light-grey); /* Border around thumb */
        }

        .sensitivity-slider::-webkit-slider-thumb:hover {
            transform: scale(1.15); /* More pronounced scale */
            cursor: grabbing;
        }

        .sensitivity-slider::-moz-range-thumb {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--primary-green), var(--dark-green));
            cursor: grab;
            border: 2px solid var(--light-grey);
            box-shadow: 0 4px 15px var(--shadow-color);
            transition: background 0.3s ease, transform 0.3s ease;
        }

        .sensitivity-slider::-moz-range-thumb:hover {
            transform: scale(1.15);
            cursor: grabbing;
        }

        .sensitivity-value {
            font-size: 1.1em; /* Slightly larger */
            margin-top: 8px; /* Increased margin */
            color: var(--light-grey);
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        /* Footer / Ending Border - visually separate the content below */
        .expo-footer {
            width: 100%;
            margin-top: 40px; /* Ample space from last section */
            padding-top: 25px;
            border-top: 2px solid var(--primary-green); /* Solid, prominent green line */
            text-align: center;
            color: var(--text-color-faded);
            font-size: 0.95em;
            opacity: 0.7;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
            position: relative;
            padding-bottom: 10px;
        }

        .expo-footer::before {
            content: '';
            position: absolute;
            top: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px; /* Short line to mark the center */
            height: 2px;
            background-color: var(--primary-green);
            box-shadow: 0 0 10px var(--primary-green);
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="club-header">
            <div class="club-logo-large">
                <img src="aclogo.png" alt="Android Club Logo"> </div>
            <h1 class="club-main-title">Android Club</h1>
            <p class="club-celebration-tag">üéâ Celebrating 10 Years! üéâ</p>
            <p class="club-expo-text"></p>
        </div>
        
        <div class="game-section">
            <div class="game-header">
                <h2 class="game-title">üïπÔ∏è Dual Paddle Bounce</h2>
            </div>
            
            <div class="score-board">
                <div class="player-info">
                    <div class="player-name">Player 1</div>
                    <div class="player-score" id="player1Score">0</div>
                    <div class="controls">W / S</div>
                </div>
                <div class="player-info">
                    <div class="player-name">Player 2</div>
                    <div class="player-score" id="player2Score">0</div>
                    <div class="controls">‚Üë / ‚Üì</div>
                </div>
            </div>
            
            <canvas id="gameCanvas" width="1000" height="400"></canvas>
            
            <div class="game-status" id="gameStatus">
                Press any key to start!
            </div>
            
            <div style="text-align: center;">
                <button class="restart-btn" onclick="restartGame()">üîÑ Restart Game</button>
            </div>
            
            <div class="difficulty-controls">
                <div class="difficulty-section">
                    <div style="font-size: 1.2em; margin-bottom: 10px; font-weight: bold;">üéØ Game Difficulty</div>
                    <div class="difficulty-buttons">
                        <button class="difficulty-btn active" onclick="setDifficulty('easy')">Easy</button>
                        <button class="difficulty-btn" onclick="setDifficulty('medium')">Medium</button>
                        <button class="difficulty-btn" onclick="setDifficulty('hard')">Hard</button>
                        <button class="difficulty-btn" onclick="setDifficulty('insane')">Insane</button>
                    </div>
                </div>
            </div>

            <div class="sensitivity-controls">
                <div class="sensitivity-section">
                    <div class="sensitivity-label">üéÆ Player 1 Sensitivity</div>
                    <input type="range" id="player1Sensitivity" class="sensitivity-slider" min="0.3" max="2" step="0.1" value="1" oninput="updateSensitivity(1, this.value)">
                    <div class="sensitivity-value" id="player1SensValue">1.0x</div>
                </div>
                <div class="sensitivity-section">
                    <div class="sensitivity-label">üéÆ Player 2 Sensitivity</div>
                    <input type="range" id="player2Sensitivity" class="sensitivity-slider" min="0.3" max="2" step="0.1" value="1" oninput="updateSensitivity(2, this.value)">
                    <div class="sensitivity-value" id="player2SensValue">1.0x</div>
                </div>
            </div>
            
            <div class="game-instructions">
                First to 5 points wins! Ball speed increases over time. Keep an eye on the ball!
            </div>
        </div>
        <div class="expo-footer">
          <h1 id="credits">Developed by Vishal Prabhu</h1>
            &copy; 2025 Android Club. All Rights Reserved.
            <br>
            Thanks for celebrating with us!
        </div>

    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const player1ScoreEl = document.getElementById('player1Score');
        const player2ScoreEl = document.getElementById('player2Score');
        const gameStatusEl = document.getElementById('gameStatus');

        // Game state
        let gameRunning = false;
        let gameStarted = false;
        let winner = null;
        let currentDifficulty = 'easy';

        // Paddle properties
        const paddleWidth = 15;
        const basePaddleSpeed = 6; // Base speed, multiplied by sensitivity
        let player1Sensitivity = 1.0;
        let player2Sensitivity = 1.0;

        // Ball properties
        let ballSize = 12; // Will be set by difficulty
        let ballSpeedX = 0; // Initialized to 0, set on resetBall
        let ballSpeedY = 0; // Initialized to 0, set on resetBall
        let initialBallSpeed = 4; // Will be set by difficulty
        let maxBallSpeed = 8; // Will be set by difficulty
        let ballAcceleration = 1.05; // Will be set by difficulty

        // Difficulty settings
        const difficultySettings = {
            easy: {
                initialSpeed: 8,
                maxSpeed: 14,
                acceleration: 1.02,
                paddleHeight: 80,
                ballSize: 12
            },
            medium: {
                initialSpeed: 10,
                maxSpeed: 16,
                acceleration: 1.05,
                paddleHeight: 70,
                ballSize: 10
            },
            hard: {
                initialSpeed: 12,
                maxSpeed: 18,
                acceleration: 1.08,
                paddleHeight: 60,
                ballSize: 8
            },
            insane: {
                initialSpeed: 15,
                maxSpeed: 20,
                acceleration: 1.12,
                paddleHeight: 50,
                ballSize: 6
            }
        };

        // Game objects
        let player1 = {
            x: 30,
            y: canvas.height / 2 - difficultySettings.easy.paddleHeight / 2, // Initialize with easy paddle height
            width: paddleWidth,
            height: difficultySettings.easy.paddleHeight,
            score: 0,
            upPressed: false,
            downPressed: false
        };

        let player2 = {
            x: canvas.width - 30 - paddleWidth,
            y: canvas.height / 2 - difficultySettings.easy.paddleHeight / 2, // Initialize with easy paddle height
            width: paddleWidth,
            height: difficultySettings.easy.paddleHeight,
            score: 0,
            upPressed: false,
            downPressed: false
        };

        let ball = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            dx: 0, // Will be set on resetBall
            dy: 0, // Will be set on resetBall
            size: difficultySettings.easy.ballSize // Initialize with easy ball size
        };

        // Input handling
        const keys = {};

        document.addEventListener('keydown', (e) => {
            keys[e.key.toLowerCase()] = true;
            
            // Prevent default scroll behavior for arrow keys and spacebar (if spacebar is used in game)
            if (['arrowup', 'arrowdown', ' ', 'w', 's'].includes(e.key.toLowerCase())) {
                e.preventDefault();
            }

            if (!gameStarted && !winner) {
                startGame();
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key.toLowerCase()] = false;
        });

        function handleInput() {
            const player1Speed = basePaddleSpeed * player1Sensitivity;
            const player2Speed = basePaddleSpeed * player2Sensitivity;
            
            // Player 1 controls (W/S)
            if (keys['w'] && player1.y > 0) {
                player1.y -= player1Speed;
            }
            if (keys['s'] && player1.y < canvas.height - player1.height) {
                player1.y += player1Speed;
            }

            // Player 2 controls (Arrow keys)
            if (keys['arrowup'] && player2.y > 0) {
                player2.y -= player2Speed;
            }
            if (keys['arrowdown'] && player2.y < canvas.height - player2.height) {
                player2.y += player2Speed;
            }
        }

        function updateBall() {
            if (!gameRunning) return;

            ball.x += ball.dx;
            ball.y += ball.dy;

            // Ball collision with top and bottom walls
            if (ball.y - ball.size <= 0 || ball.y + ball.size >= canvas.height) {
                ball.dy = -ball.dy;
                playBounceSound();
            }

            // Ball collision with paddles
            // Player 1 paddle
            if (ball.dx < 0 &&
                ball.x - ball.size <= player1.x + player1.width &&
                ball.y + ball.size >= player1.y &&
                ball.y - ball.size <= player1.y + player1.height
            ) {
                if (ball.x - ball.size < player1.x + player1.width) {
                     ball.x = player1.x + player1.width + ball.size;
                }
                ball.dx = -ball.dx;
                increaseBallSpeed();
                playBounceSound();
            }

            // Player 2 paddle
            if (ball.dx > 0 &&
                ball.x + ball.size >= player2.x &&
                ball.y + ball.size >= player2.y &&
                ball.y - ball.size <= player2.y + player2.height
            ) {
                if (ball.x + ball.size > player2.x) {
                    ball.x = player2.x - ball.size;
                }
                ball.dx = -ball.dx;
                increaseBallSpeed();
                playBounceSound();
            }

            // Scoring
            if (ball.x + ball.size < 0) {
                player2.score++;
                updateScores();
                checkWinner();
                if (!winner) resetBall();
            } else if (ball.x - ball.size > canvas.width) {
                player1.score++;
                updateScores();
                checkWinner();
                if (!winner) resetBall();
            }
        }

        function increaseBallSpeed() {
            const speed = Math.sqrt(ball.dx * ball.dx + ball.dy * ball.dy);
            if (speed < maxBallSpeed) {
                ball.dx *= ballAcceleration;
                ball.dy *= ballAcceleration;
            }
        }

        function setDifficulty(difficulty) {
            currentDifficulty = difficulty;
            const settings = difficultySettings[difficulty];
            
            // Update difficulty settings
            initialBallSpeed = settings.initialSpeed;
            maxBallSpeed = settings.maxSpeed;
            ballAcceleration = settings.acceleration;
            ballSize = settings.ballSize;
            
            // Update paddle heights
            player1.height = settings.paddleHeight;
            player2.height = settings.paddleHeight;
            
            // Update ball size
            ball.size = ballSize;
            
            // Update button states
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            const clickedButton = document.querySelector(`.difficulty-btn[onclick*="setDifficulty('${difficulty}')"]`);
            if (clickedButton) {
                clickedButton.classList.add('active');
            }
            
            // Reset game if it's running
            if (gameStarted) {
                restartGame();
            } else {
                // If game not started, just apply the settings and reset positions
                player1.y = canvas.height / 2 - player1.height / 2;
                player2.y = canvas.height / 2 - player2.height / 2;
                resetBall();
                render(); // Render with new settings immediately
            }
        }

        function updateSensitivity(player, value) {
            const sensitivity = parseFloat(value);
            if (player === 1) {
                player1Sensitivity = sensitivity;
                document.getElementById('player1SensValue').textContent = sensitivity.toFixed(1) + 'x';
            } else {
                player2Sensitivity = sensitivity;
                document.getElementById('player2SensValue').textContent = sensitivity.toFixed(1) + 'x';
            }
        }

        function resetBall() {
            ball.x = canvas.width / 2;
            ball.y = canvas.height / 2;
            // Ensure initial speed is set based on current difficulty
            ball.dx = (Math.random() > 0.5 ? 1 : -1) * initialBallSpeed;
            ball.dy = (Math.random() > 0.5 ? 1 : -1) * initialBallSpeed;
            ball.size = ballSize; // Apply current ball size
        }

        function updateScores() {
            player1ScoreEl.textContent = player1.score;
            player2ScoreEl.textContent = player2.score;
        }

        function checkWinner() {
            if (player1.score >= 5) {
                winner = "Player 1";
                gameRunning = false;
                gameStatusEl.innerHTML = '<div class="winner-message">üéâ Player 1 Wins! üéâ</div>';
            } else if (player2.score >= 5) {
                winner = "Player 2";
                gameRunning = false;
                gameStatusEl.innerHTML = '<div class="winner-message">üéâ Player 2 Wins! üéâ';
            }
        }

        function playBounceSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            } catch (e) {
                console.warn("AudioContext not supported or failed to play sound:", e);
            }
        }

        function drawPaddle(paddle) {
            ctx.fillStyle = '#E7E7E7';
            ctx.shadowColor = 'rgba(231, 231, 231, 0.6)';
            ctx.shadowBlur = 12;
            ctx.fillRect(paddle.x, paddle.y, paddle.width, paddle.height);
            ctx.shadowBlur = 0;
        }

        function drawBall() {
            ctx.fillStyle = '#189807';
            ctx.shadowColor = 'rgba(24, 152, 7, 0.9)';
            ctx.shadowBlur = 18;
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.size, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowBlur = 0;
        }

        function drawCenterLine() {
            ctx.strokeStyle = 'rgba(231, 231, 231, 0.4)';
            ctx.lineWidth = 3; /* Thicker line */
            ctx.setLineDash([15, 15]); /* Longer dashes */
            ctx.beginPath();
            ctx.moveTo(canvas.width / 2, 0);
            ctx.lineTo(canvas.width / 2, canvas.height);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        function render() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.35)'; /* Slightly more opaque for better trail */
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            drawCenterLine();
            drawPaddle(player1);
            drawPaddle(player2);
            drawBall(); 
        }

        function gameLoop() {
            handleInput();
            updateBall();
            render();
            requestAnimationFrame(gameLoop);
        }

        function startGame() {
            if (!gameStarted) {
                gameStarted = true;
                gameRunning = true;
                gameStatusEl.textContent = "Game in progress...";
                resetBall(); // Ensure ball is reset with current difficulty speeds
            }
        }

        function restartGame() {
            gameRunning = false;
            gameStarted = false;
            winner = null;
            player1.score = 0;
            player2.score = 0;
            
            const settings = difficultySettings[currentDifficulty];
            player1.y = canvas.height / 2 - settings.paddleHeight / 2;
            player2.y = canvas.height / 2 - settings.paddleHeight / 2;
            player1.height = settings.paddleHeight;
            player2.height = settings.paddleHeight;
            
            player2.x = canvas.width - 30 - player2.width;
            ball.x = canvas.width / 2;

            updateScores();
            resetBall(); // Call resetBall to ensure speed and size are correct
            gameStatusEl.textContent = "Press any key to start!";
            render(); // Render initial state after reset
        }

        // Initialize game and set initial difficulty active button
        window.onload = () => {
            // Apply initial difficulty settings
            setDifficulty(currentDifficulty); // This will also call resetBall and render

            // Ensure sensitivity values are displayed correctly on load
            document.getElementById('player1Sensitivity').value = player1Sensitivity.toFixed(1);
            document.getElementById('player1SensValue').textContent = player1Sensitivity.toFixed(1) + 'x';
            document.getElementById('player2Sensitivity').value = player2Sensitivity.toFixed(1);
            document.getElementById('player2SensValue').textContent = player2Sensitivity.toFixed(1) + 'x';

            gameLoop(); // Start the animation loop
        };
    </script>
</body>
</html>